# Foundry Stack Configuration
# Edit this file to match your infrastructure

cluster:
  name: <CLUSTER_NAME>  # e.g., homelab, production
  primary_domain: <PRIMARY_DOMAIN>  # e.g., lab.local, example.com
  vip: <VIP>  # K3s API VIP, e.g., 192.168.1.100

network:
  gateway: <GATEWAY>  # e.g., 192.168.1.1
  netmask: <NETMASK>  # e.g., 255.255.255.0

dns:
  backend: sqlite
  api_key: ${secret:foundry-core/dns:api_key}
  forwarders:
    - 1.1.1.1
    - 8.8.8.8
  # Infrastructure zones get A records for openbao, dns, zot, k8s
  infrastructure_zones:
    - name: <PRIMARY_DOMAIN>
      public: false
  # Kubernetes zones get wildcard records and are managed by external-dns
  # Add additional domains here if needed
  kubernetes_zones:
    - name: <PRIMARY_DOMAIN>
      public: false

# Add your infrastructure hosts below
# Each host needs roles assigned from:
#   - cluster-control-plane: K3s control plane
#   - cluster-worker: K3s worker
#   - openbao: Secrets management
#   - dns: PowerDNS server
#   - zot: Container registry
hosts:
  # Example single-node configuration:
  # - hostname: node1.lab.local
  #   address: 192.168.1.20
  #   port: 22
  #   user: foundry
  #   roles:
  #     - cluster-control-plane
  #     - openbao
  #     - dns
  #     - zot
  #   state: new
  #   labels:  # Optional: Kubernetes node labels
  #     environment: production
  #     zone: us-east-1a

components:
  openbao:
    version: latest

  k3s:
    version: latest
    ha: false  # Set to true for multi-control-plane
    # additional_registries:
    #   - name: "10.16.0.40:5000"       # Internal HTTP registry
    #     http: true
    #   - name: "registry.example.com"   # Private HTTPS registry
    #     username: "user"
    #     password: "pass"
    #   - name: "selfsigned.corp:5000"   # Self-signed HTTPS registry
    #     insecure: true

  zot:
    version: latest

# Optional: Observability configuration (Phase 3)
# observability:
#   prometheus:
#     retention: 30d
#   loki:
#     retention: 90d

# Optional: Storage configuration (Phase 3)
# storage:
#   backend: longhorn  # Options: local-path, nfs, longhorn
#   longhorn:
#     replica_count: 3
#     data_path: /var/lib/longhorn

setup_state:
  network_planned: false
  network_validated: false
  openbao_installed: false
  openbao_initialized: false
  dns_installed: false
  dns_zones_created: false
  zot_installed: false
  k8s_installed: false
  stack_complete: false
